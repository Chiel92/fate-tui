#!python
"""Top level script which runs fate."""
import os
import sys

# Make sure fate can be imported anywhere (also from the user script).
# This way we can:
# - run fate without having it installed
# - and thus easily test development source
# - have multiple fate packages, in case we would use multiple user interfaces.
path_to_fate = os.path.dirname(os.path.abspath(__file__)) + '/lib_fate/'
sys.path.insert(0, path_to_fate)

from tui.userinterface import UserInterface
import curses


# Lower the annoying delay for the escape character
# VIM also uses 25 ms
os.environ['ESCDELAY'] = '25'


def main(stdscr):
    """Initialize curses and start application."""

    # Initialize color pairs from the terminal color palette
    # 0 is the default, 1-16 are the palette colors,
    # 17-32 are palette colors with a different background
    # We assume that color 8 has good contrast with other colors
    curses.start_color()
    curses.use_default_colors()
    for i in range(0, 15):
        curses.init_pair(i + 1, i, -1)
        curses.init_pair(i + 17, i, 8)

    # No cursor
    curses.curs_set(0)

    # Key input settings
    curses.raw()
    stdscr.keypad(1)

    filenames = sys.argv[1:] or ['']
    for filename in filenames:
        ui = UserInterface(stdscr, filename)

    ui.activate()

curses.wrapper(main)
