#!python
"""Top level script which runs fate."""
import os
import sys

# Make sure fate can be imported anywhere (also from the user script).
# This way we can:
# - run fate without having it installed
# - and thus easily test development source
# - have multiple fate packages, in case we would use multiple user interfaces.
path_to_fate = os.path.dirname(os.path.abspath(__file__)) + '/lib_fate/'
sys.path.insert(0, path_to_fate)

from tui.userinterface import UserInterface, ui_list
import signal
import curses


def handle_ctrl_c(sig, frame):
    curses.unget_wch(3)


def handle_ctrl_z(sig, frame):
    curses.unget_wch(26)


def handle_ctrl_bslash(sig, frame):
    pass

# Intercept ctrl-c, ctrl-z and ctrl-\
signal.signal(signal.SIGINT, handle_ctrl_c)
signal.signal(signal.SIGTSTP, handle_ctrl_z)
signal.signal(signal.SIGQUIT, handle_ctrl_bslash)


# Lower the annoying delay for the escape character
# VIM also uses 25 ms
os.environ['ESCDELAY'] = '25'


def main(stdscr):
    """Initialize curses and start application."""

    # Initialize color pairs from the terminal color palette
    # 0 is the default, 1-16 are the palette colors,
    # 17-32 are palette colors with a different background
    curses.use_default_colors()
    for i in range(0, 15):
        curses.init_pair(i + 1, i, -1)
        curses.init_pair(i + 17, i, 8)

    curses.curs_set(0)
    stdscr.keypad(1)

    filenames = sys.argv[1:] or ['']
    for filename in filenames:
        UserInterface(stdscr, filename)

    ui_list[0].activate()

curses.wrapper(main)
